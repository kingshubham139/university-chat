<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat</title>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#ece5dd}
.chat{
  max-width:480px;margin:auto;height:100vh;
  display:flex;flex-direction:column;background:#fff;
}
header{
  background:#075e54;color:#fff;
  padding:12px;text-align:center;
}
#messages{flex:1;padding:10px;overflow-y:auto}
.msg{
  padding:8px;margin:6px;border-radius:8px;
  max-width:70%;
}
.me{background:#dcf8c6;margin-left:auto}
.other{background:#f1f0f0}
footer{display:flex}
footer input{flex:1;padding:12px}
footer button{
  background:#075e54;color:#fff;
  border:none;padding:12px;
}
</style>
</head>

<body>
<div class="chat">
  <header id="title"></header>
  <div id="messages"></div>
  <footer>
    <input id="text" placeholder="Type message">
    <button onclick="send()">Send</button>
  </footer>
</div>

<script>
const API = "https://university-chat-production.up.railway.app";

// ðŸ” session check (VERY IMPORTANT)
const user = JSON.parse(localStorage.getItem("user"));
if(!user){
  window.location.href = "index.html";
}

title.innerText = "Group: " + user.groupName;

const socket = io(API);
socket.emit("join", user.groupName);

socket.on("receive", msg => show(msg));
socket.on("deleted", id=>{
  const el = document.getElementById(id);
  if(el) el.remove();
});

function send(){
  if(text.value.trim()==="") return;
  socket.emit("send",{
    text:text.value,
    sender:user.username,
    groupName:user.groupName
  });
  text.value="";
}

function show(m){
  const div = document.createElement("div");
  div.className = "msg " + (m.sender===user.username?"me":"other");
  div.id = m._id;
  div.innerHTML = `<b>${m.sender}</b><br>${m.text}`;

  if(m.sender===user.username){
    div.onclick = ()=>socket.emit("delete", m._id);
  }

  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}
</script>
</body>
</html>
